# ุฏููู ูุธุงู ุงูุญูุธ ุงูุฐูู ููุชุนุฏููุงุช ุงููุฏููุฉ
## HAIROTICMEN Trading OS - Smart Merge Seeder v3

**ุงูุชุงุฑูุฎ**: 16 ููููุจุฑ 2025  
**ุงูุญุงูุฉ**: โ **ุฌุงูุฒ ููุฅูุชุงุฌ - ุงุฎุชุจุงุฑ ูุงูู**  
**ุงูุณูุฑูุจุช**: `server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts`

---

## ๐ฏ ุงููุฏู

**ุญู ุงููุดููุฉ ุงูุฃุณุงุณูุฉ**: ุนูุฏูุง ุชููู ุจุชุญุฑูุฑ ุจูุงูุงุช ุงูููุชุฌุงุช ูุฏููุงู ูู Google Sheets (ุชุบููุฑ ุงูุฃุณุนุงุฑุ ุงูุฃูุฒุงูุ ุงููุฆุงุชุ ุงูุดุญูุ ุฅูุฎ)ุ ุซู ุชุดุบู ุงูุณูุฑูุจุช ูุฑุฉ ุฃุฎุฑูุ **ูุฌุจ ุฃู ุชุจูู ุชุนุฏููุงุชู** ููุง ุชูุณุชุจุฏู ุจุงูููู ุงูุงูุชุฑุงุถูุฉ ูู ูููุงุช ุงูุฅุนุฏุงุฏ.

---

## โ ูุง ุชู ุชูููุฐู ุจุงููุงูู

### 1. ูุธุงู ุญูุธ ุฐูู ุดุงูู โ

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ 1. READ             โ ูุฑุงุกุฉ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ ุญุงููุงู
โ    Existing Data    โ (ูุน ุฌููุน ุชุนุฏููุงุชู ุงููุฏููุฉ)
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ 2. BUILD            โ ุจูุงุก ุงูุจูุงูุงุช ูู ูููุงุช ุงูุฅุนุฏุงุฏ
โ    Config Data      โ (ุงูููู ุงูุงูุชุฑุงุถูุฉ)
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ 3. MERGE            โ ุฏูุฌ ุฐูู:
โ    Smart Merge      โ ุชุนุฏููุงุชู ููุง ุงูุฃููููุฉ ุงููุตูู!
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ 4. CLEAR            โ ูุณุญ ุงูุจูุงูุงุช ุงููุฏููุฉ
โ    Old Data         โ (ูููุน ุงูุชูุฑุงุฑ)
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ 5. WRITE            โ ูุชุงุจุฉ ุงููุชูุฌุฉ ุงููุฏูุฌุฉ
โ    Merged Result    โ (ุชุนุฏููุงุชู ูุญููุธุฉ!)
โโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. ุฌููุน ุงูุญููู ุงููุญููุธุฉ ุชููุงุฆูุงู โ

#### ูู FinalPriceList (23 ุญูู):

**ูุนูููุงุช ุงูููุชุฌ:**
- `Category` - ุงููุฆุฉ
- `Line` - ุงูุฎุท (Premium, Skin, Professional, etc.)
- `Brand` - ุงูุนูุงูุฉ ุงูุชุฌุงุฑูุฉ

**ุงูุชูุงููู (6 ุญููู):**
- `Factory_Cost_EUR` - ุชูููุฉ ุงููุตูุน
- `Packaging_Cost_EUR` - ุชูููุฉ ุงูุชุนุจุฆุฉ
- `Freight_kg_EUR` - ุชูููุฉ ุงูุดุญู ูููููู
- `Box_Cost_Per_Unit` - ุชูููุฉ ุงูุตูุฏูู ูููุญุฏุฉ

**ุงูููุงุตูุงุช ุงููุงุฏูุฉ:**
- `Weight_g` - ุงููุฒู ุจุงูุฌุฑุงู
- `Content_ml` - ุงูุญุฌู ุจุงููููู
- `Net_Content_ml` - ุงูุญุฌู ุงูุตุงูู
- `Dims_cm` - ุงูุฃุจุนุงุฏ (ุทููรุนุฑุถรุงุฑุชูุงุน)

**ุงูุชุนุจุฆุฉ:**
- `Box_Size` - ุญุฌู ุงูุตูุฏูู (Small, Medium, Large)

**ุงูุดุญู (7 ุญููู):**
- `Shipping_Actual_Kg` - ุงููุฒู ุงููุนูู ููุดุญู
- `Shipping_Volumetric_Kg` - ุงููุฒู ุงูุญุฌูู
- `Shipping_CarrierID` - ุดุฑูุฉ ุงูุดุญู
- `ShipCost_per_Unit_OwnStore` - ุชูููุฉ ุงูุดุญู ูููุชุฌุฑ
- `ShipCost_per_Unit_FBA` - ุชูููุฉ ุดุญู ุฃูุงุฒูู FBA
- `ShipCost_per_Unit_FBM` - ุชูููุฉ ุดุญู FBM
- `ShipCost_per_Unit_B2B` - ุชูููุฉ ุดุญู B2B

**ุญููู ูุฏููุฉ ุฃุฎุฑู:**
- `Manual_UVP_Inc` - ุงูุณุนุฑ ุงููุฏูู
- `DHL_Zone` - ููุทูุฉ DHL
- `Gift_SKU` - ููุฏ ุงููุฏูุฉ
- `Gift_SKU_Cost` - ุชูููุฉ ุงููุฏูุฉ

#### ูู Packaging_Boxes (13 ุญูู):

**ููุน ุงูุตูุฏูู:**
- `BoxType` - ููุน ุงูุตูุฏูู
- `BoxSubtype` - ุงูููุน ุงููุฑุนู

**ุงูุฃุจุนุงุฏ ุงูุฏุงุฎููุฉ:**
- `Inner_L_cm` - ุงูุทูู ุงูุฏุงุฎูู
- `Inner_W_cm` - ุงูุนุฑุถ ุงูุฏุงุฎูู
- `Inner_H_cm` - ุงูุงุฑุชูุงุน ุงูุฏุงุฎูู

**ุงูุฃุจุนุงุฏ ุงูุฎุงุฑุฌูุฉ:**
- `Outer_L_cm` - ุงูุทูู ุงูุฎุงุฑุฌู
- `Outer_W_cm` - ุงูุนุฑุถ ุงูุฎุงุฑุฌู
- `Outer_H_cm` - ุงูุงุฑุชูุงุน ุงูุฎุงุฑุฌู

**ุงูุฃูุฒุงู ูุงูุชูุงููู:**
- `Tare_Weight_g` - ูุฒู ุงูุตูุฏูู ุงููุงุฑุบ
- `Max_Weight_kg` - ุงููุฒู ุงูุฃูุตู
- `Unit_Cost_EUR` - ุชูููุฉ ุงููุญุฏุฉ
- `Units_Per_Carton` - ุนุฏุฏ ุงููุญุฏุงุช ูู ุงููุฑุชููุฉ
- `Carton_Cost_EUR` - ุชูููุฉ ุงููุฑุชููุฉ
- `Supplier` - ุงูููุฑุฏ

---

## ๐ ููููุฉ ุงูุงุณุชุฎุฏุงู

### ุงููุฑุฉ ุงูุฃููู (ุฅูุดุงุก ุงูุจูุงูุงุช):

```bash
# ุชุดุบูู ูุน ูุณุญ ูุงูู
FULL_RESET=true tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

**ุงููุชูุฌุฉ**:
- ุฅูุดุงุก ุฌููุน ุงูุฌุฏุงูู
- ููุคูุง ุจุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ ูู ูููุงุช ุงูุฅุนุฏุงุฏ
- โ 60 ููุชุฌุ 8 ุดุฑูุงุกุ 20 ุทูุจุ 7 ุตูุงุฏูู ุชุนุจุฆุฉ

### ุจุนุฏ ุงูุชุนุฏููุงุช ุงููุฏููุฉ:

```bash
# ุชุดุบูู ุนุงุฏู - ูุญูุธ ุชุนุฏููุงุชู ุชููุงุฆูุงู!
tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

**ูุง ูุญุฏุซ**:
1. ๐ ููุฑุฃ ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ (ูุน ุชุนุฏููุงุชู)
2. ๐๏ธ  ูุจูู ุงูุจูุงูุงุช ูู ุงูุฅุนุฏุงุฏ
3. ๐ ูุฏูุฌ: **ุชุนุฏููุงุชู ููุง ุงูุฃููููุฉ**
4. ๐๏ธ  ููุณุญ ุงูุจูุงูุงุช ุงููุฏููุฉ
5. ๐ค ููุชุจ ุงููุชูุฌุฉ ุงููุฏูุฌุฉ
6. โ **ุชุนุฏููุงุชู ูุญููุธุฉ!**

### ูุถุน ุงูุงุฎุชุจุงุฑ (DRY_RUN):

```bash
# ููุงุฎุชุจุงุฑ ููุท - ูู ููุชุจ ุดูุฆุงู
DRY_RUN=true tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

**ุงุณุชุฎุฏูู**:
- ูุจู ุงูุชุดุบูู ุงููุนูู
- ููุชุญูู ูู ุนุฏุฏ ุงูุชุนุฏููุงุช ุงููุญููุธุฉ
- ููุฑุงุฌุนุฉ ูุง ุณูุญุฏุซ

### ุชุนุทูู ุงูุญูุธ (ุฅุฐุง ุฃุฑุฏุช):

```bash
# ูุงุณุชุจุฏุงู ูู ุดูุก ุจุงูููู ุงูุงูุชุฑุงุถูุฉ
PRESERVE_EDITS=false FULL_RESET=true tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

---

## ๐ ูุซุงู ุนููู ูุงูู

### ุงูุณููุงุฑูู: ุชุญุฏูุซ ุชูููุฉ ููุชุฌ

#### 1. ุงููุถุน ุงูุฃููู (ุจุนุฏ ุงูุชุดุบูู ุงูุฃูู):

```
SKU: HM-P-BEARD-001
Name: Beard Oil Premium
Factory_Cost_EUR: 3.50  โ ูู ููู ุงูุฅุนุฏุงุฏ
Box_Size: Small         โ ูู ููู ุงูุฅุนุฏุงุฏ
ShipCost_per_Unit_OwnStore: 2.40  โ ูู ููู ุงูุฅุนุฏุงุฏ
```

#### 2. ุฃูุช ุชููู ุจุงูุชุญุฑูุฑ ูู Google Sheets:

```
SKU: HM-P-BEARD-001
Factory_Cost_EUR: 3.50 โ 4.80 โ๏ธ (ุบูุฑุช ูุฏููุงู)
Box_Size: Small โ Medium โ๏ธ (ุบูุฑุช ูุฏููุงู)
ShipCost_per_Unit_OwnStore: 2.40 โ 3.20 โ๏ธ (ุบูุฑุช ูุฏููุงู)
```

#### 3. ุชุดุบูู ุงูุณูุฑูุจุช ูุฑุฉ ุฃุฎุฑู:

```bash
tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

**ูู ุงููููุณูู ุณุชุฑู**:
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  HAIROTICMEN Smart Merge Seeder - User Edit Preservation v3
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

๐ Spreadsheet ID: 1U5UP_9gPkB-8TVLPKxnG1Ey3Q2aChG2KvzjjnbcFsg0
๐ง Mode: ๐ WRITE MODE
โญ Preserve Edits: YES (user edits override config)

๐ PHASE 2: Reading Existing Data (for merge)
  โข FinalPriceList: 60 existing rows
  โข Packaging_Boxes: 7 existing rows

๐ PHASE 4: Smart Merge (User Edits Override Config)
  ๐ FinalPriceList: Merged 60 rows (3 user edits preserved)
  ๐ Packaging_Boxes: Merged 7 rows (0 user edits preserved)
  โญ Total user edits preserved: 3

โ SMART MERGE SEEDING COMPLETE!
```

#### 4. ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

```
SKU: HM-P-BEARD-001
Factory_Cost_EUR: 4.80 โ (ูุญููุธ!)
Box_Size: Medium โ (ูุญููุธ!)
ShipCost_per_Unit_OwnStore: 3.20 โ (ูุญููุธ!)
```

---

## ๐ ููู ุขููุฉ ุงูุฏูุฌ

### ุงูุญููู ุงููุฏุงุฑุฉ ูู ุงููุณุชุฎุฏู (User-Managed):

ูุฐู ุงูุญููู **ุชุญุชูุธ ุจูููู** ุฏุงุฆูุงู:
```typescript
โ ุฅุฐุง ููุช ุจุชุนุฏูููุง โ ุชุจูู ูููู
โ ุฅุฐุง ูู ุชุนุฏููุง โ ุชุณุชุฎุฏู ุงูุฅุนุฏุงุฏ
โ ุฅุฐุง ูุงุฑุบุฉ โ ุชุณุชุฎุฏู ุงูุฅุนุฏุงุฏ
```

### ุงูุญููู ุงููุญุณูุจุฉ ุชููุงุฆูุงู:

ูุฐู ุงูุญููู **ุชูุญุณุจ ุฏุงุฆูุงู** ูู ุฌุฏูุฏ:
```typescript
โ๏ธ COGS_EUR - ุชูุญุณุจ ูู ุงูุชูุงููู
โ๏ธ FullCost_EUR - ุชูุญุณุจ ูู COGS + Overhead
โ๏ธ Shipping_Chargeable_Kg - ุชูุญุณุจ ูู max(Actual, Volumetric)
โ๏ธ UVP_Inc - ุชูุญุณุจ ูู ุงูุชูููุฉ + Margin
```

**ููุงุฐุงุ**
ูุฃููุง ุชุนุชูุฏ ุนูู ุญููู ุฃุฎุฑู. ุฅุฐุง ุญูุธูุงูุงุ ูุฏ ุชุตุจุญ ุบูุฑ ูุชุณูุฉ.

---

## โ๏ธ ุงูุชูููู ุงููุชูุฏู

### ูุชุบูุฑุงุช ุงูุจูุฆุฉ:

```bash
# ุชูุนูู/ุชุนุทูู ุงูุญูุธ (ุงูุชุฑุงุถู: true)
PRESERVE_EDITS=true

# ูุถุน ุงูุงุฎุชุจุงุฑ (ุงูุชุฑุงุถู: false)
DRY_RUN=true

# ูุณุญ ูุงูู (ุงูุชุฑุงุถู: false)
FULL_RESET=true

# ุญุฌู ุงูุฏูุนุฉ (ุงูุชุฑุงุถู: 250)
WRITE_BATCH_SIZE=250

# ุชุฃุฎูุฑ ุจูู ุงูุฏูุนุงุช (ุงูุชุฑุงุถู: 500ms)
WRITE_COOLDOWN_MS=500

# ุนุฏุฏ ุงูููุชุฌุงุช (ุงูุชุฑุงุถู: 60)
NUM_PRODUCTS=100
```

### ูุซุงู ุงุณุชุฎุฏุงู ูุฎุตุต:

```bash
# ุชุดุบูู ุจุฏูู ุญูุธ + ูุณุญ ูุงูู + ุงุฎุชุจุงุฑ
PRESERVE_EDITS=false FULL_RESET=true DRY_RUN=true tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

---

## ๐ ุญุงูุงุช ุงูุงุณุชุฎุฏุงู ุงูุดุงุฆุนุฉ

### ุญุงูุฉ 1: ุชุญุฏูุซ ุฃุณุนุงุฑ ูุฆุฉ ูุงููุฉ

```
1. ุงูุชุญ Google Sheets
2. ููุชุฑ ุญุณุจ Category = "Beard Care"
3. ุญุฏุฏ ุฌููุน ุงูุตููู (Ctrl+Click)
4. ุบููุฑ Factory_Cost_EUR ุจูุณุจุฉ +10%
5. ุงุญูุธ (ุชููุงุฆู)
6. ุดุบูู ุงูุณูุฑูุจุช
7. โ ุฌููุน ุงูุชุบููุฑุงุช ูุญููุธุฉ!
```

### ุญุงูุฉ 2: ุชุญุฏูุซ ุชูุงููู ุงูุดุญู

```
1. ุงูุชุญ Google Sheets
2. ุงุฐูุจ ุฅูู ุนููุฏ ShipCost_per_Unit_FBA
3. ุบููุฑ ุงูููู ูุฌููุน ุงูููุชุฌุงุช
4. ุดุบูู ุงูุณูุฑูุจุช
5. โ ุฌููุน ุชูุงููู ุงูุดุญู ูุญููุธุฉ!
```

### ุญุงูุฉ 3: ุฅุถุงูุฉ ููุชุฌ ุฌุฏูุฏ

```
1. ุฃุถู ุงูุจูุงูุงุช ูู ููู product-slug-mapping-complete.json
2. ุดุบูู ุงูุณูุฑูุจุช
3. โ ุงูููุชุฌ ุงูุฌุฏูุฏ ููุถุงู
4. โ ุงูููุชุฌุงุช ุงููุฏููุฉ ุชุญุชูุธ ุจุชุนุฏููุงุชู
```

### ุญุงูุฉ 4: ุชุบููุฑ ุฃุจุนุงุฏ ุตูุฏูู ุงูุชุนุจุฆุฉ

```
1. ุงูุชุญ Packaging_Boxes sheet
2. ุบููุฑ PackageID = "Medium"
3. ุนุฏูู Inner_L_cm, Inner_W_cm, Inner_H_cm
4. ุนุฏูู Unit_Cost_EUR
5. ุดุบูู ุงูุณูุฑูุจุช
6. โ ุฌููุน ุงูุฃุจุนุงุฏ ูุงูุชูุงููู ูุญููุธุฉ!
```

---

## ๐ก๏ธ ุงูุฃูุงู ูุงูููุซูููุฉ

### ุงูุถูุงูุงุช:

โ **ุนุฏู ุงูุชูุฑุงุฑ**: ูู ุชูุถุงู ุตููู ููุฑุฑุฉ  
โ **ุงูุญูุธ ุงููุงูู**: ุฌููุน 23 ุญูู ูู FinalPriceList ูุญููุฉ  
โ **Idempotency**: ููุณ ุงููุชูุฌุฉ ูู ูู ุชุดุบูู  
โ **DRY_RUN**: ุงุฎุชุจุงุฑ ุขูู ุจุฏูู ุชุบููุฑุงุช  
โ **Clear ูุจู Write**: ูููุน ุงูุชุฑุงูู  
โ **Primary Key ูุฑูุฏ**: ูุถูู ุงูุฏูุฉ  

### ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก:

```typescript
// 1. ุฅุฐุง ูู ููุฌุฏ ุจูุงูุงุช ุญุงููุฉ
if (existingData.length === 0) {
  return configRows; // ุงุณุชุฎุฏู ุงูุฅุนุฏุงุฏ ููุท
}

// 2. ุฅุฐุง ุงูููุชุงุญ ุงูุฃุณุงุณู ุบูุฑ ููุฌูุฏ
if (keyIndex === -1) {
  return configRows; // ุงุณุชุฎุฏู ุงูุฅุนุฏุงุฏ ููุท
}

// 3. ุฅุฐุง ุงููููุฉ ูุงุฑุบุฉ
if (existingValue === '' || existingValue === undefined) {
  return configValue; // ุงุณุชุฎุฏู ุงูุฅุนุฏุงุฏ
}

// 4. ุฅุฐุง ุงููููุฉ ูุฎุชููุฉ
if (existingValue !== configValue) {
  preservedCount++; // ุงุญุตู ุงูุชุนุฏูู
  return existingValue; // โ ุงุณุชุฎุฏู ุชุนุฏูู ุงููุณุชุฎุฏู
}
```

---

## ๐ ููุงุญุธุงุช ุชูููุฉ ูููุฉ

### ููุงุฐุง ูุง ูุญูุธ ShippingWeightBandsุ

```typescript
// โ ูุดููุฉ: CarrierID ุบูุฑ ูุฑูุฏ
CarrierID: "DHL", Weight_Min: 0, Weight_Max: 250
CarrierID: "DHL", Weight_Min: 251, Weight_Max: 700
CarrierID: "DHL", Weight_Min: 701, Weight_Max: 2000

// ููุณ CarrierID ูู 3 ุตููู!
// ูุง ูููู ุชุญุฏูุฏ ุฃู ุตู ูุญูุธ
```

**ุงูุญู**: ShippingWeightBands ูุณุชุฎุฏู ุงูุฅุนุฏุงุฏ ุฏุงุฆูุงู (ูุง ุญูุธ).

### ุงูุชุญูู ูู Primary Keys:

```typescript
// โ ุตุญูุญ: FinalPriceList
primaryKey: 'SKU'
// ูู SKU ูุฑูุฏ โ ูุนูู ุงูุฏูุฌ ุจุดูู ูุซุงูู

// โ ุตุญูุญ: Packaging_Boxes
primaryKey: 'PackageID'
// ูู PackageID ูุฑูุฏ โ ูุนูู ุงูุฏูุฌ ุจุดูู ูุซุงูู

// โ ุฎุทุฃ: ShippingWeightBands
primaryKey: 'CarrierID'
// CarrierID ููุฑุฑ โ ูุง ูุนูู ุงูุฏูุฌ
```

---

## ๐ง ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุชุนุฏููุงุชู ูู ุชูุญูุธ

**ุงูุญู**:
```bash
# 1. ุชุญูู ูู PRESERVE_EDITS
echo $PRESERVE_EDITS  # ูุฌุจ ุฃู ูููู: true

# 2. ุชุญูู ูู ุงุณู ุงูุนููุฏ
# ูู ุงูุนููุฏ ูู ูุงุฆูุฉ userManagedFieldsุ

# 3. ุชุญูู ูู DRY_RUN
# ุฅุฐุง ูุงู DRY_RUN=trueุ ูู ูููุชุจ ุดูุก
```

### ุงููุดููุฉ: ุตููู ููุฑุฑุฉ

**ุงูุณุจุจ**: ูุณุฎุฉ ูุฏููุฉ ูู ุงูุณูุฑูุจุช

**ุงูุญู**:
```bash
# 1. ุงุณุชุฎุฏู ุฃุญุฏุซ ูุณุฎุฉ (v3)
# 2. ุงูุณูุฑูุจุช ุงูุขู ููุณุญ ูุจู ุงููุชุงุจุฉ ุชููุงุฆูุงู
# 3. ูู ุชุญุฏุซ ูุฐู ุงููุดููุฉ ุจุนุฏ ุงูุขู
```

### ุงููุดููุฉ: ุงูููู ุงูุงูุชุฑุงุถูุฉ ุงุณุชุจุฏูุช ุชุนุฏููุงุชู

**ุงูุฃุณุจุงุจ ุงููุญุชููุฉ**:
```bash
# 1. PRESERVE_EDITS=false
PRESERVE_EDITS=true tsx server/scripts/...

# 2. ุงูุนููุฏ ููุณ ูู userManagedFields
# ุฑุงุฌุน ูุงุฆูุฉ ุงูุญููู ุงููุญููุธุฉ ุฃุนูุงู

# 3. ุงููููุฉ ูุงูุช ูุงุฑุบุฉ
# ุงูุญููู ุงููุงุฑุบุฉ ุชุณุชุฎุฏู ุงูุฅุนุฏุงุฏ
```

---

## โ ูุงุฆูุฉ ุงูุชุญูู ูุจู ุงูุงุณุชุฎุฏุงู

### ูุจู ุงูุชุดุบูู ุงูุฃูู:

- [ ] ุชุญูู ูู Google Sheets Connector ูุชุตู
- [ ] ุชุญูู ูู SPREADSHEET_ID ุตุญูุญ
- [ ] ุดุบูู ูู ูุถุน DRY_RUN ุฃููุงู
- [ ] ุฑุงุฌุน ุงููููุณูู ููุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก

### ูุจู ุงูุชุดุบูู ุจุนุฏ ุงูุชุนุฏููุงุช:

- [ ] PRESERVE_EDITS=true (ุงูุชุฑุงุถู)
- [ ] ุชุฃูุฏ ูู ุชุนุฏููุงุชู ูุญููุธุฉ ูู Google Sheets
- [ ] ููุถู DRY_RUN ุฃููุงู ููุชุญูู
- [ ] ุงุญูุธ ูุณุฎุฉ ุงุญุชูุงุทูุฉ ุฅุฐุง ูุงูุช ุจูุงูุงุช ูููุฉ

### ุจุนุฏ ุงูุชุดุบูู:

- [ ] ุฑุงุฌุน ุงููููุณูู: ูู ุชุนุฏูู ุชู ุญูุธูุ
- [ ] ุงูุชุญ Google Sheets ูุชุญูู ูู ุจูุงูุงุชู
- [ ] ุดุบูู pricing-master.ts ูุญุณุงุจ ุงูุฃุณุนุงุฑ
- [ ] ุดุบูู validate-and-repair-workbook.ts ููุชุญูู

---

## ๐ ุงูุฅุญุตุงุฆูุงุช ุงููุชููุนุฉ

### ุชุดุบูู ูููุฐุฌู:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ SMART MERGE SEEDING COMPLETE!

๐ Summary:
   โข 60 products in FinalPriceList
   โข 8 B2B partners
   โข 20 orders with 67 line items
   โข 5 quotes with 13 line items
   โข 3 bundle definitions
   โข 23 enum values for dropdowns
   โข 7 packaging definitions
   โข 7 shipping weight bands

โญ USER EDIT PRESERVATION:
   โข FinalPriceList: 45 user edits preserved
   โข Packaging_Boxes: 8 user edits preserved
   โข Total: 53 manual edits kept intact!

โญ๏ธ  NEXT STEPS:
   1. Run pricing-master.ts to calculate full pricing
   2. Run 07-validate-and-repair-workbook.ts for validation
   3. Review your Google Sheet to verify data
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

### ูุง ุญููู ูุฐุง ุงููุธุงู:

โ **ุญูุธ ุชููุงุฆู**: 23 ุญูู ูู FinalPriceList + 13 ุญูู ูู Packaging_Boxes  
โ **ุฃููููุฉ ูููุณุชุฎุฏู**: ุชุนุฏููุงุชู ุชุชุบูุจ ุนูู ุงูุฅุนุฏุงุฏ ุฏุงุฆูุงู  
โ **ููุน ุงูุชูุฑุงุฑ**: ูุณุญ ุฐูู ูุจู ุงููุชุงุจุฉ  
โ **Idempotent**: ููุณ ุงููุชูุฌุฉ ูู ูู ุชุดุบูู  
โ **ุขูู**: DRY_RUN ููุงุฎุชุจุงุฑ  
โ **ุดูุงู**: ุชูุงุฑูุฑ ูุงุถุญุฉ ุนู ูุง ุชู ุญูุธู  
โ **ููุซูู**: ุงุฎุชุจุงุฑ ูุงูู ูู architect  

### ูุชู ุชุณุชุฎุฏูู:

```
โ ุนูุฏ ุฅูุดุงุก ุงูุจูุงูุงุช ูุฃูู ูุฑุฉ
โ ุนูุฏ ุฅุถุงูุฉ ููุชุฌุงุช ุฌุฏูุฏุฉ
โ ุจุนุฏ ุชุนุฏูู ุงูุฃุณุนุงุฑ ูุฏููุงู
โ ุจุนุฏ ุชุญุฏูุซ ุงูุชูุงููู
โ ุจุนุฏ ุชุนุฏูู ูุนูููุงุช ุงูุดุญู
โ ุจุนุฏ ุชุญุฏูุซ ุจูุงูุงุช ุงูุชุนุจุฆุฉ
โ ูู ุฃู ููุช ุชุฑูุฏ ูุฒุงููุฉ ุงูุฅุนุฏุงุฏ ูุน ุงูุฌุฏูู
```

### ูุชู ูุง ุชุณุชุฎุฏูู:

```
โ ุฅุฐุง ููุช ุชุฑูุฏ ุฅุนุงุฏุฉ ุถุจุท ูู ุดูุก ููุงูุชุฑุงุถู
   (ุงุณุชุฎุฏู PRESERVE_EDITS=false ุจุฏูุงู ูู ุฐูู)
โ ุฅุฐุง ููุช ุชุฑูุฏ ููุท ุฑุคูุฉ ูุง ุณูุญุฏุซ
   (ุงุณุชุฎุฏู DRY_RUN=true ุจุฏูุงู ูู ุฐูู)
```

---

## ๐ ุงูุจุฏุงูุฉ ุงูุณุฑูุนุฉ

### ุฎุทูุฉ 1: ุงูุชุดุบูู ุงูุฃูู

```bash
# ุฅูุดุงุก ุฌููุน ุงูุจูุงูุงุช
FULL_RESET=true tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

### ุฎุทูุฉ 2: ูู ุจุชุนุฏููุงุชู

ุงูุชุญ Google Sheets ูุนุฏูู ูุง ุชุดุงุก!

### ุฎุทูุฉ 3: ุดุบูู ูุฑุฉ ุฃุฎุฑู

```bash
# ุชุนุฏููุงุชู ูุญููุธุฉ ุชููุงุฆูุงู!
tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

### ุฎุทูุฉ 4: ุงุญุณุจ ุงูุฃุณุนุงุฑ

```bash
tsx server/scripts/pricing-master.ts
```

### ุฎุทูุฉ 5: ุชุญูู ูู ุงูุตุญุฉ

```bash
tsx server/scripts/build-sheet-from-scratch/07-validate-and-repair-workbook.ts
```

---

## ๐ ุงูุฏุนู

### ุงููุซุงุฆู ุงูุฃุฎุฑู:

- `08-SCHEMA-FIXES.md` - ุชุงุฑูุฎ ุงูุชุตุญูุญุงุช
- `server/lib/ensure-sheets.ts` - ุชุนุฑููุงุช ุงูุฌุฏุงูู
- `server/config/hairoticmen-pricing.json` - ููู ุงูุฅุนุฏุงุฏ

### ุณุฌู ุงูุชุบููุฑุงุช:

**v3.0** (16 ููููุจุฑ 2025)
- โ ูุธุงู ุญูุธ ุฐูู ูุงูู
- โ 23 ุญูู ูุญููุธ ูู FinalPriceList
- โ 13 ุญูู ูุญููุธ ูู Packaging_Boxes
- โ ููุน ุงูุชูุฑุงุฑ ุจุงููุณุญ ูุจู ุงููุชุงุจุฉ
- โ ุงุฎุชุจุงุฑ ูุงูู ูู architect
- โ ุฌุงูุฒ ููุฅูุชุงุฌ

---

---

## ๐ ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ ูู v4: Dynamic Schema Preservation

### ูุง ูู Dynamic Schemaุ

ูู **v3**ุ ูุงู ุงููุธุงู ูุญูุธ **ุงูููู** ููุท (ุงูุฃุณุนุงุฑุ ุงูุฃูุฒุงูุ ุฅูุฎ).  
ูู **v4**, ุงููุธุงู ูุญูุธ **ุงูููู ูุงูู Schema** (ุฃุณูุงุก ุงูุฃุนูุฏุฉุ ุงูุชุฑุชูุจุ ุงูุฃุนูุฏุฉ ุงูุฌุฏูุฏุฉ)!

### ุงูููุฒุงุช ุงูุฌุฏูุฏุฉ:

โ **ุชุบููุฑ ุฃุณูุงุก ุงูุฃุนูุฏุฉ**  
   - ูุซุงู: "Factory_Cost_EUR" โ "ุชูููุฉ_ุงููุตูุน"
   - ุงููุธุงู ููุชุดู ุงูุชุบููุฑ ููุณุชุฎุฏู ุงูุงุณู ุงูุฌุฏูุฏ

โ **ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุฃุนูุฏุฉ**  
   - ุฑุชุจ ุงูุฃุนูุฏุฉ ููุง ุชุดุงุก ูู Google Sheets
   - ุงููุธุงู ูุญุชุฑู ุงูุชุฑุชูุจ ุงูุฌุฏูุฏ

โ **ุฅุถุงูุฉ ุฃุนูุฏุฉ ุฌุฏูุฏุฉ**  
   - ุฃุถู ุนููุฏ "Custom_Field" ูู Google Sheets
   - ุงููุธุงู ูุญูุธ ุงูููู ูู ุงูุนููุฏ ุงูุฌุฏูุฏ

โ **ุชุบููุฑ ุฃุณูุงุก ุงููุฆุงุช ูู Enums**  
   - ุบููุฑ "Beard Care" โ "ุงูุนูุงูุฉ ุจุงููุญูุฉ"
   - ุงููุธุงู ููุฑุฃ ุงูุฃุณูุงุก ุงูุฌุฏูุฏุฉ ูู Google Sheets

### ููููุฉ ุงูุชูุนูู:

```bash
# ุชูุนูู Schema Preservation (ุงูุชุฑุงุถู: true)
ALLOW_SCHEMA_MUTATIONS=true tsx server/scripts/build-sheet-from-scratch/08-seed-all-fixtures.ts
```

### ูุซุงู ุนููู:

#### 1. ุชุบููุฑ ุงุณู ุนููุฏ:

```
1. ุงูุชุญ Google Sheets โ FinalPriceList
2. ุบููุฑ header "Factory_Cost_EUR" โ "ูุตูุน_ุชูููุฉ"
3. ุดุบูู ุงูุณูุฑูุจุช
```

**ุงููุชูุฌุฉ**:
```
๐ Schema Changes Detected: FinalPriceList
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  ๐ Renamed Columns:
     โข "Factory_Cost_EUR" โ "ูุตูุน_ุชูููุฉ"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ุงูุจูุงูุงุช ุชููุชุจ ูู ุงูุนููุฏ ุงูุฌุฏูุฏ "ูุตูุน_ุชูููุฉ"
โ ุฌููุน ุงูููู ูุญููุธุฉ
```

#### 2. ุฅุถุงูุฉ ุนููุฏ ุฌุฏูุฏ:

```
1. ุงูุชุญ Google Sheets โ FinalPriceList
2. ุฃุถู ุนููุฏ ุฌุฏูุฏ "Custom_Notes" ูู ุงูููุงูุฉ
3. ุงูุชุจ ุจุนุถ ุงูููุงุญุธุงุช ูู ุงูุตููู
4. ุดุบูู ุงูุณูุฑูุจุช
```

**ุงููุชูุฌุฉ**:
```
๐ Schema Changes Detected: FinalPriceList
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
  โ New Columns Added:
     โข "Custom_Notes"
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

โ ุงูุนููุฏ ุงูุฌุฏูุฏ ูุญููุธ
โ ุฌููุน ุงูููุงุญุธุงุช ูุญููุธุฉ
```

#### 3. ุชุบููุฑ ุงุณู ูุฆุฉ ูู Enums:

```
1. ุงูุชุญ Google Sheets โ Enums
2. ุงุจุญุซ ุนู List="Category", Key="Beard Care"
3. ุบููุฑ Label ูู "Beard Care" โ "ุงูุนูุงูุฉ ุจุงููุญูุฉ"
4. ุดุบูู ุงูุณูุฑูุจุช
```

**ุงููุชูุฌุฉ**:
```
โ ุงุณู ุงููุฆุฉ ุงูุฌุฏูุฏ ูุญููุธ ูู Enums
โ ูุธูุฑ "ุงูุนูุงูุฉ ุจุงููุญูุฉ" ูู ุงูููุงุฆู ุงูููุณุฏูุฉ
```

### ุงูุญูุงูุฉ ูู ุงูุฃุฎุทุงุก:

#### โ ุญุฐู ุนููุฏ ููู (Primary Key):

```
1. ุญุฐูุช ุนููุฏ "SKU" ูู FinalPriceList
2. ุดุบูู ุงูุณูุฑูุจุช
```

**ุงููุชูุฌุฉ**:
```
โ FinalPriceList: Critical schema errors detected
โ๏ธ  Primary key column "SKU" is missing or renamed without alias

๐ Script stopped! Use FULL_RESET=true to override.
```

### ุงููููุฏ ูุงูููุงุญุธุงุช:

โ๏ธ **Primary Keys** ูุญููุฉ:
- ูุง ูููู ุญุฐู SKUุ PackageIDุ OrderIDุ ุฅูุฎ
- ุฅุฐุง ุญุฐูุชูุงุ ุงูุณูุฑูุจุช ูุชููู (ุฅูุง ุฅุฐุง FULL_RESET=true)

โ๏ธ **ุงูุญููู ุงููุญุณูุจุฉ** ุชูุนุงุฏ ุญุณุงุจูุง:
- COGS_EURุ UVP_Incุ FullCost_EUR
- ูุฐู ุชูุญุณุจ ุฏุงุฆูุงู ูู ุฌุฏูุฏ (ูุง ุชูุญูุธ)

โ **ุงูุฃุนูุฏุฉ ุงููุฏุนููุฉ ููุชุบููุฑ**:
- ุฌููุน ุงูุญููู ูู userManagedFields
- ุฃู ุนููุฏ ุฌุฏูุฏ ุชุถููู ุฃูุช

### ูุถุนูู ููุนูู:

```bash
# v4: ุญูุธ Schema + ุงูููู (ููุตู ุจู)
ALLOW_SCHEMA_MUTATIONS=true tsx server/scripts/...

# v3: ุญูุธ ุงูููู ููุท (legacy mode)
ALLOW_SCHEMA_MUTATIONS=false tsx server/scripts/...
```

### ุงููุฑู ุจูู v3 ู v4:

| ุงูููุฒุฉ | v3 | v4 |
|--------|----|----|
| ุญูุธ ุงูููู | โ | โ |
| ุชุบููุฑ ุฃุณูุงุก ุงูุฃุนูุฏุฉ | โ | โ |
| ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูุฃุนูุฏุฉ | โ | โ |
| ุฅุถุงูุฉ ุฃุนูุฏุฉ ุฌุฏูุฏุฉ | โ | โ |
| ุชุบููุฑ ุฃุณูุงุก ุงููุฆุงุช | โ | โ |

---

**ุชู ุงูุชุทููุฑ ูุงูุงุฎุชุจุงุฑ ุจูุฌุงุญ! ๐**  
**ุงุณุชูุชุน ุจูุธุงู ูุญูุธ ุนููู ููุง ูุถูุนู! ๐**

**v4 Update**: ุงูุขู ูุน **Dynamic Schema Preservation** - ุชุญูู ูุงูู ูู ุงูู Schema! ๐จ
